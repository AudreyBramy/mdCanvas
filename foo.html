<html>	
	<head>
	<title>bar test</title>
	<script src="https://code.jquery.com/jquery.js"></script>
	<script>
		window.onload = function() {
			console.log( "jQuery " + (window.jQuery ? "success" : "failure"));

			var filename = 'bar.txt';
			//var file = getFile(filename);
			//var fileProceeded;
			//getFileDerf(filename);

			var file = getFileDerf(filename);


			//proceedFile(getFileDerf(filename));
			proceedFile(file);

			var thatFile = procFile(file, 'This', 'THAT');
			var whohayFile = procFile(thatFile, 'THAT', 'WHOHAY');

			// closure
			var proceedFile = function(content) {
				fileProceeded = file.replace('bar', 'FOO');
				console.log("content of variable fileProceeded: " + tmp);
			}

			function getFileDerf(filename) {
				return $.get( filename, function( data ) { 
						//console.log( data );
						//return data;
						content = data;
						console.log("getFileDerf: " + content);
					}, 'text' );
			}

			/*
			function proceedFile(futureFile) {
				futureFile.done(function(result) {
				 var tmp = result.replace('bar', 'FOO');
					console.log(tmp);
				});
			}
			*/
			function proceedFile(futureFile) {
				// return new Promise(function(resolve, reject)) }
				futureFile.done(function(result) {
				 	var tmp = result.replace('bar', 'FOO');
					console.log(tmp);
				 	tmp = tmp.replace('FOO', 'BAR');
					console.log(tmp);
					// return somehow  tmp	
				});
			}

			// @todo how to store the returned value!!!!
			// https://stackoverflow.com/questions/14220321/how-do-i-return-the-response-from-an-asynchronous-call
			// http://www.danieldemmel.me/blog/2013/03/22/an-introduction-to-jquery-deferred-slash-promise/
			// @todo 20170522 hier weitermachen!!! https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html
			// return new Promise(function(resolve, reject)) }
			function procFile(file, search, replace) {
				return file.done(function(result){
					var tmp = result.replace(search, replace);
					console.log(replace + ": " + tmp);
				});
			}



			function getFile( filename ) { 

				$.get( filename, function( data ) { 
						//console.log( data );
						//return data;
						content = data;
					}, 'text' )
				.done( function(  ){ 
						console.log('get.done: ' + content);
						proceedFile(content);
					} );
			}
			/*
			console.log("content of variable file: " + file);

			// work on the result of fileProceeded
			file2 = fileProceeded.replace('FOO', 'BAR');
			console.log("content of variable file2: " + file2)
			*/

		}	
	</script>
	</head>
	<body>
	</body>
</html>
