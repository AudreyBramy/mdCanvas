<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>MdCanvas</title>
	<link rel="stylesheet" href="mdCanvas.css" type="text/css" media="screen" charset="utf-8">
  	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="mdCanvas.js"></script>
	<script src="mdfiles.js"></script>
  	<script src="https://cdn.rawgit.com/showdownjs/showdown/1.4.2/dist/showdown.min.js"></script>
  </head>
  <body>
  <div id="sidebar">
	  <ul id="link">
	  </ul>
  </div>
  <div class="containerbox">
    <h1 id="mdc-canvas">LeanCanvas</h1>
    <div class="flex">
      <div id="mdc-problem">problem</div>
      <div class="box">
		  <div id="mdc-solution">solution</div>
		  <div id="mdc-key-metrics">key metrics</div>
	  </div>
      <div id="mdc-unique-value-proposition">unique-value-proposition</div>
      <div class="box">
		  <div id="mdc-unfair-advantage">unfair advantage</div>
		  <div id="mdc-channels">channels</div>
	  </div>
	  <div id="mdc-customer-segment">customer-segment</div>
    </div>
    <div class="flex">
      <div id="mdc-cost-structure">cost-structure</div>
      <div id="mdc-revenue-stream">revenue-stream</div>
    </div>
  	<div id="mdc-todo"></div>
  </div>
	
	<script type="text/javascript" charset="utf-8">

	// generate sections for the canvas
	function doSections( md ) { 
		var result = md.split( "#" );
		var sections = {  };
		// console.log( result );
		$.each( result, function( key, value ) { 
			if ( value != "" ) {  
				//console.log( key + ": " + value );

				// get the heading
				var header = value.split( "\n" );
				//console.log( key + ":" +header[0] );

				// add header to the section
				sections[objKey( header[0] )] = '###' + value;

				// get the name of the canvas or project name
				if ( header[0].includes( "anvas" ) ) { 
					sections[objKey( header[0] )] = header[1];
				}
			}
		} );
		return sections;
	}

	// generate object key
	function objKey( name ) { 
		return 'mdc-' + name.toLowerCase().trim();
	}

	// process the markdown content
	function showmd( value ) { 
		var sections = doSections( value );
		// console.log( sections );

		$.each( sections, function( key, value ) { 
			// console.log( key + ": " + value );
			var tagId = "#" + key;
			
			var sdown = new showdown.Converter(  ), text = value, html = sdown.makeHtml( text );
			$( tagId ).html( html );
		});
	}

	// get url parameter
	var md = getUrlParameter( "md" ) || "mdCanvas";
	var pathmd = md + ".md";

	// get markdown file and content
	$.get( pathmd, function( data ) {
		showmd( data );
	}, 'text');

	/****
	 * code to get a list of all lean canvas and link them! 
	 * does only work in the server context, not on the local file system
	 * And locally with a workaround of a windows batch file
	 ***/ 
	http://stackoverflow.com/a/23189786/1933185

	(function($) {
		
		var filenames = g_FOLDER_CONTENTS.match(/\S+/g);
		//console.log( filenames );
		var cleanFilenames = $.map( filenames, function( n ) { 
			return( ( /readme/i ).test( n ) ? null : n );
			} );
		//console.log( cleanFilenames );
		$.each( cleanFilenames, function( key, value ) { 
			console.log( value );
			var li = $( '<li>' ).appendTo( '#link' );
			var name = value.slice( 0,-3 );
			// $( '<a>', { text: value, href: '?md=' + value.slice( 0,-3 ) } ).appendTo( '#link' );
			$( '<a>', { text: name, href: '?md=' + name } ).appendTo( li );
		});
	}( jQuery ));

	</script>
  </body>
</html>	
