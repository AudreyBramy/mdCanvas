<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <title>QUnit 2.2.0 - SHTTP Running ????</title>
      <link rel="stylesheet" href="qunit-2.2.0.css">
   </head>
   <body>
      <div id="qunit"></div>
      <div id="qunit-fixture"></div>
      <script src="qunit-2.2.0.js"></script>
	  <!-- 
		https://www.sitepoint.com/getting-started-qunit/
	  	Same as in the module.html, had to adapt relative path 

		Added systemjs and the things, as I am not sure that qunit can 
		handle es6

		@todo Perhaps add the feature to load the tests via Javascript
		http://davidvujic.blogspot.de/2015/03/es6-and-tdd-can-i-test-it.html
	  -->
	  <script src="../js/systemjs/dist/system.js"></script>
	  <script>
		SystemJS.import('https://code.jquery.com/jquery.js');

		SystemJS.config({
		  map: {
			'plugin-babel': '../js/plugin-babel/plugin-babel.js',
			'systemjs-babel-build': '../js/plugin-babel/systemjs-babel-browser.js'
		  },
		  transpiler: 'plugin-babel'
		});

	  </script>
	  <!-- same as in the module.html -->
	  <script type="text/javascript" charset="utf-8">
		SystemJS.import('../js/modules/mdCanvas.js').then( function( qob ) { 
	  	
			// assign the module class to the variable: use
			var use = new qob.main;
			// console.log( new qob.main(  ).say );
			// console.log( use.say );
			QUnit.module( "Unit Tests" ); 

			QUnit.test( "getUrl - check url", function( assert ) { 
				var uri = 'test.de'; // http://t3n.de/news/url-uri-unterschiede-516483/
				var url = "http://" + uri;
				assert.equal( use.getUrlParams( url + "?md=mdFoo" ), "md=mdFoo", "Default md-file mdCanvas is true" );
			} );

			QUnit.test( "getFilenameFrom - get filename from url", function( assert ) { 
				// assert.equal( use.getFilenameFrom( ), "mdCanvas", "Default md-file mdCanvas is true" ); // This will not work, as the parameter url cannot be undefined
				assert.equal( use.getFilenameFrom( '' ), "mdCanvas", "Default md-file mdCanvas is true" );
				assert.equal( use.getFilenameFrom( 'http://test.de?' ), "mdCanvas", "Default md-file mdCanvas is true" );
				assert.equal( use.getFilenameFrom( 'md=mdFoo'), "mdFoo", "md-file mdFoo is true" );
				assert.equal( use.getFilenameFrom( 'md=mdFoo&foo=bar'), "mdFoo", "md-file mdFoo is true" );
				assert.equal( use.getFilenameFrom( 'mdx=mdFoo&foo=bar'), "mdCanvas", "Default md-file mdCanvas is true" );
			} );

			/*
			// there is no return methode on this function, the tests make no sense
			QUnit.test( 'getFile content of the md-file', function( assert ) { 
				assert.notOk( use.getFile(  ) , 'There is no file content, missing filename parameter'  );
				assert.notOk( use.getFile( 'mdFoo' ), 'There is no file content, filename does not exists' );
				// hard to test, as it is async. 
				//assert.ok( use.getFile( 'mdCanvas' ).includes( '#' ), 'There is file content' );
			} );
			*/

			QUnit.test( 'getSections - split file in sections for the canvas boxes', function( assert ) { 
				var content = "# Canvas \n#Section";
				assert.ok( Array.isArray(use.getSections( content )), 'Return value is an array' );
				assert.ok( use.getSections( content ), 'There are sections' );
				assert.ok( use.getSections( ) instanceof Error, 'There is missing content. Error thrown' );
				assert.ok( use.getSections( 'no sections' ).length == 1, 'There are no sections' );
				content = content + "\n some more \nlines of text\n does this work?";
				assert.ok( use.getSections( content ), 'There are sections' );
			} )

			QUnit.test( 'getHeader - get heading for the canvas', function( assert ) { 
				var content = "# Canvas \n Lean Canvas"; // "#Section \nThis is a description\nof the section foo.";
				assert.ok( use.getHeader( content ), 'There is a heading' );
				assert.ok( (typeof use.getHeader( content ) === "string"), 'Heading is a string' );
				/** makes no sense to test that
				 * assert.ok( use.getHeading( content ).indexOf( '#' ) != -1, 'Heading contains a hash ( # )' );
				 *assert.ok( use.getHeading( content.substr( 1 ) ).indexOf( '#' ) == -1, 'Heading contains a NO hash ( # )' );
				 *assert.ok( use.getHeading( '#' + content ).indexOf( '#' ) != -1, 'Heading contains a hash ( # )' );
				 *assert.ok( use.getHeading( '##' + content ).indexOf( '#' ) != -1, 'Heading contains a hash ( # )' );
				 */
			} )

			QUnit.test( 'getBox - get content for the canvas boxes', function( assert ) { 
				var content = " Problem \n 1. First Problem\n2. Problem"; // "#Section \nThis is a description\nof the section foo.";
				// https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript
				// https://stackoverflow.com/a/13356338/1933185
				assert.ok( Object.prototype.toString.call(use.getBox( content )) === "[object Object]", 'There is an object' );
				assert.ok( use.getBox( content, 1 ).hasOwnProperty( 'name' ), 'There is an property called name' );
				assert.ok( use.getBox( content, 1 ).name  == "Problem", 'Property name = Problem' );
				assert.ok( use.getBox( content, 1 ).hasOwnProperty( 'content' ), 'There is an property called content' );
				//console.log( 'substring', use.getBox( content, 1 ).content.substring( 0, 10 ) );
				assert.ok( use.getBox( content, 1 ).content.substring( 0, 11 )  == "### Problem", 'Property content starts with "### Problem"' );
				/** makes no sense to test that
				 * assert.ok( use.getHeading( content ).indexOf( '#' ) != -1, 'Heading contains a hash ( # )' );
				 *assert.ok( use.getHeading( content.substr( 1 ) ).indexOf( '#' ) == -1, 'Heading contains a NO hash ( # )' );
				 *assert.ok( use.getHeading( '#' + content ).indexOf( '#' ) != -1, 'Heading contains a hash ( # )' );
				 *assert.ok( use.getHeading( '##' + content ).indexOf( '#' ) != -1, 'Heading contains a hash ( # )' );
				 */
			} )


			QUnit.test( "say - smoketest", function( assert ) {
				var checkString = "es6";
				//assert.ok( use.say.includes( checkString ), "String contains" + checkString);
				// http://es6-features.org/#StringInterpolation
				assert.ok( use.say.includes( checkString ), `String containts ${ checkString }`);
			} );

			/*
			QUnit.module( "Integration Tests" ); 
			QUnit.test( 'init - check parsing', function( assert ) { 
					// there is no return method for getFile, so I cannot test.... Currently 2017-03-31 it works :) regarding the console.log output
					assert.ok( use.init( 'http://test.de?md=../mdCanvas' ), 'There is a heading' );
			} )
			*/

		} );

	  </script>
   </body>
</html>
